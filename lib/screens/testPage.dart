import 'dart:io';
import 'package:flutter/material.dart';
import 'package:soccerstreams/helpers/displaySize.dart';
import 'package:webview_flutter/webview_flutter.dart';
import 'package:flutter/services.dart';

class TestPage extends StatefulWidget {
  final src;
  TestPage({this.src});

  @override
  TestPageState createState() => TestPageState();
}

class TestPageState extends State<TestPage> {
  String src;
  @override
  void initState() {
    super.initState();
    // Enable hybrid composition.
    if (Platform.isAndroid) WebView.platform = SurfaceAndroidWebView();
    this.src = widget.src;
  }

  @override
  Widget build(BuildContext context) {
    double fWidth = displayWidth(context) * .995;
    double fheight = displayHeight(context) * .995;

    if (fheight > fWidth) {
      var temp = fWidth;
      fWidth = fheight;
      fheight = temp;
    }

    final iframe =
        "<iframe width='$fWidth' height='$fheight'src='$src'></iframe>";

    return WillPopScope(
      onWillPop: () async {
        SystemChrome.setEnabledSystemUIOverlays(SystemUiOverlay.values);
        await SystemChrome.setPreferredOrientations([]);
        return Future.value(true);
      },
      child: WebView(
        initialUrl: Uri.dataFromString(
                "<html><body style='margin:0;'>$iframe</body></html>",
                mimeType: 'text/html')
            .toString(),
        javascriptMode: JavascriptMode.unrestricted,
      ),
    );
  }
}

final initUrl =
    "<div class='persistent-player tw-elevation-0' data-a-player-state='' data-test-selector='persistent-player' style='top: 0px; left: 0px; position: absolute; max-height: calc(100vh - 16rem); overflow: hidden; z-index: 1; height: auto; transition: transform 0.5s ease 0s; transform-origin: center top; transform: scale(1);'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 hhnnBG'></div><div class='video-player' data-a-target='video-player' data-a-player-type='site' data-test-selector='video-player__video-layout'><div class='tw-absolute tw-bottom-0 tw-left-0 tw-overflow-hidden tw-right-0 tw-top-0 video-player__container video-player__container--resize-calc' data-test-selector='video-player__video-container'><video playsinline='' webkit-playsinline='' src='blob:https://www.twitch.tv/8226fb92-a043-4b27-a0fc-e089805d7fcc'></video><div class='video-player__default-player video-player__inactive'><div class='tw-absolute tw-bottom-0 tw-left-0 tw-right-0 tw-top-0 video-player__overlay'><div class='tw-absolute tw-bottom-0 tw-left-0 tw-right-0 tw-top-0'><div class='tw-absolute tw-bottom-0 tw-left-0 tw-right-0 tw-top-0 avap-ads-container'><iframe id='amazon-video-ads-iframe' style='width: 100%; height: 100%; border: 0px; display: none;'></iframe></div></div><div class='click-handler tw-absolute tw-bottom-0 tw-left-0 tw-right-0 tw-top-0' data-a-target='player-overlay-click-handler'></div><div class='tw-transition tw-transition--exit-done tw-transition__fade tw-transition__fade--exit-done' style='transition-delay: 0ms; transition-duration: 250ms;'><div class='top-bar tw-absolute tw-flex tw-flex-grow-1 tw-justify-content-between tw-left-0 tw-right-0 tw-top-0'><div class=''><div class='top-bar--pointer-enabled'></div></div><div class='tw-align-items-start tw-flex'><div class='top-bar--pointer-enabled tw-align-items-center tw-flex'><div class='tw-pd-l-1'><div class='ScChannelStatusTextIndicator-sc-1f5ghgf-0 dVmkcd tw-channel-status-text-indicator' font-size='font-size-6'><p class='tw-strong tw-upcase tw-white-space-nowrap'>LIVE</p></div></div><div class='tw-pd-l-1'></div></div></div></div></div><div class='celebration__overlay tw-absolute tw-align-items-center tw-flex tw-full-height tw-full-width tw-justify-content-center tw-left-0 tw-top-0 tw-z-above'></div><div class='tw-transition tw-transition--exit-done tw-transition__fade tw-transition__fade--exit-done' style='transition-delay: 0ms; transition-duration: 250ms;'><div data-a-target='player-controls' class='player-controls tw-absolute tw-align-items-stretch tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-overflow-hidden' data-a-visible='false'><div class='tw-pd-x-2'></div><div class='tw-flex tw-mg-b-1 tw-mg-l-1 tw-mg-r-1'><div class='player-controls__left-control-group tw-align-items-center tw-flex tw-flex-grow-1 tw-justify-content-start'><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='44ffb24eb9ae9f73b9c571acce86d1bd'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Pause (space/k)' data-a-target='player-play-pause-button' data-a-player-state='playing'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='ScIconLayout-sc-1bgeryd-0 kbOjdP tw-icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px' class='ScIconSVG-sc-1bgeryd-1 cMQeyU'><g><path d='M8 3H4v14h4V3zM16 3h-4v14h4V3z'></path></g></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-left tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='44ffb24eb9ae9f73b9c571acce86d1bd'>Pause (space/k)</div></div><div><div class='tw-align-items-center tw-flex'><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='074e433fa1fed498307533c3f34f9c89'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Mute (m)' data-a-target='player-mute-unmute-button'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='ScIconLayout-sc-1bgeryd-0 kbOjdP tw-icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px' class='ScIconSVG-sc-1bgeryd-1 cMQeyU'><g><path d='M5 7l4.146-4.146a.5.5 0 01.854.353v13.586a.5.5 0 01-.854.353L5 13H4a2 2 0 01-2-2V9a2 2 0 012-2h1zM14 10a2 2 0 00-2-2v4a2 2 0 002-2z'></path></g></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-center tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='074e433fa1fed498307533c3f34f9c89'>Mute (m)</div></div><div class='tw-transition tw-transition--exit-done tw-transition__fade tw-transition__fade--exit-done volume-slider__slider-container' style='transition-delay: 0ms; transition-duration: 100ms;'><div class='tw-align-items-center tw-flex tw-full-height'><label for='player-volume-slider-bd07a237-ea00-4be6-9ba2-04343ef7739c' class='tw-hide-accessible'>Volume</label><div class='tw-flex tw-full-width tw-relative tw-z-above'><input class='tw-range tw-range--overlay' id='player-volume-slider-bd07a237-ea00-4be6-9ba2-04343ef7739c' type='range' min='0' max='1' step='0.01' data-a-target='player-volume-slider' data-a-visible='false' value='0.5'><div class='tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center tw-range__fill tw-range__fill--overlay tw-top-0 tw-z-below'><div class='tw-border-radius-large tw-range__fill-container'><div class='tw-border-radius-large tw-range__fill-value' data-test-selector='tw-range__fill-value-selector' style='width: 50%;'></div></div></div></div></div></div></div></div></div><div class='player-controls__right-control-group tw-align-items-center tw-flex tw-flex-grow-1 tw-justify-content-end' style='position: relative;'><div><div class='settings-menu-button-component settings-menu-button-component--forced-dark-theme tw-root--hover tw-root--theme-dark' data-test-selector='settings-menu-button__theme-wrapper'><div class='tw-hide'><div class='tw-absolute tw-attached tw-attached--right tw-attached--up' style='margin-right: 50px;'><div role='dialog' class='ScBalloonWrapper-jzdqb5-0 bWcMsn tw-balloon tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-3'><div class='tw-flex tw-flex-column'><div class='tw-overflow-auto tw-pd-1'></div></div></div></div></div></div><div class='' data-test-selector='settings-menu-button__animate-wrapper'><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='2204825f098942eaab954b73d299ef53'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Settings' data-a-target='player-settings-button'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='ScIconLayout-sc-1bgeryd-0 kbOjdP tw-icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px' class='ScIconSVG-sc-1bgeryd-1 cMQeyU'><g><path d='M10 8a2 2 0 100 4 2 2 0 000-4z'></path><path fill-rule='evenodd' d='M9 2h2a2.01 2.01 0 001.235 1.855l.53.22a2.01 2.01 0 002.185-.439l1.414 1.414a2.01 2.01 0 00-.439 2.185l.22.53A2.01 2.01 0 0018 9v2a2.01 2.01 0 00-1.855 1.235l-.22.53a2.01 2.01 0 00.44 2.185l-1.415 1.414a2.01 2.01 0 00-2.184-.439l-.531.22A2.01 2.01 0 0011 18H9a2.01 2.01 0 00-1.235-1.854l-.53-.22a2.009 2.009 0 00-2.185.438L3.636 14.95a2.009 2.009 0 00.438-2.184l-.22-.531A2.01 2.01 0 002 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 00-.438-2.185L5.05 3.636a2.01 2.01 0 002.185.438l.53-.22A2.01 2.01 0 009 2zm-4 8l1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z' clip-rule='evenodd'></path></g></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-right tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='2204825f098942eaab954b73d299ef53'>Settings</div></div></div></div><div class='resize-detector'><div class='resize-detector'><div class='resize-detector__grow' style='width: 100000px; height: 100000px;'></div></div><div class='resize-detector'><div class='resize-detector__shrink'></div></div></div><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='df122c75ac5ae62c7efdf395c620f83e'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Start Casting'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='tw-chromecast-button__icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px'><path class='' d='M3 17a1 1 0 0 1-1-1v-1a2 2 0 0 1 2 2H3z'></path><path class='' d='M2 12.5a.5.5 0 0 1 .5-.5A4.5 4.5 0 0 1 7 16.5a.5.5 0 0 1-1 0A3.5 3.5 0 0 0 2.5 13a.5.5 0 0 1-.5-.5z'></path><path class='' d='M2 9.5a.5.5 0 0 1 .5-.5 7.5 7.5 0 0 1 7.5 7.5.5.5 0 0 1-1 0A6.5 6.5 0 0 0 2.5 10a.5.5 0 0 1-.5-.5z'></path><path class='tw-chromecast-button__frame' d='M2 5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-3.5a1 1 0 1 1 0-2H16V5H4v1.5a1 1 0 0 1-2 0V5z'></path></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-center tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='df122c75ac5ae62c7efdf395c620f83e'>Start Casting</div></div><div class='tw-absolute tw-bottom-0 tw-mg-b-5 tw-mg-r-5 tw-right-0'></div><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='ae4e7993911a27237f12416946962e95'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Theatre Mode (alt+t)' data-a-target='player-theatre-mode-button'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='ScIconLayout-sc-1bgeryd-0 kbOjdP tw-icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px' class='ScIconSVG-sc-1bgeryd-1 cMQeyU'><g><path fill-rule='evenodd' d='M2 15V5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2zm2 0V5h7v10H4zm9 0h3V5h-3v10z' clip-rule='evenodd'></path></g></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-right tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='ae4e7993911a27237f12416946962e95'>Theatre Mode (alt+t)</div></div><div class='tw-inline-flex tw-relative tw-tooltip__container' aria-describedby='5a32698e1747e523cf4bf7de61a254a6'><button class='ScCoreButton-sc-1qn4ixc-0 ixBesj tw-button-icon tw-button-icon--overlay tw-core-button' aria-label='Fullscreen (f)' data-a-target='player-fullscreen-button'><span class='tw-button-icon__icon'><div style='width: 2rem; height: 2rem;'><div class='ScIconLayout-sc-1bgeryd-0 kbOjdP tw-icon'><div class='ScAspectRatio-sc-1sw3lwy-1 dNNaBC tw-aspect'><div class='ScAspectSpacer-sc-1sw3lwy-0 gkBhyN'></div><svg width='100%' height='100%' version='1.1' viewBox='0 0 20 20' x='0px' y='0px' class='ScIconSVG-sc-1bgeryd-1 cMQeyU'><g><path d='M7 3H2v5h2V5h3V3zM18 8V3h-5v2h3v3h2zM13 17v-2h3v-3h2v5h-5zM4 12H2v5h5v-2H4v-3z'></path></g></svg></div></div></div></span></button><div class='tw-tooltip tw-tooltip--align-right tw-tooltip--up' data-a-target='tw-tooltip-label' role='tooltip' id='5a32698e1747e523cf4bf7de61a254a6'>Fullscreen (f)</div></div></div></div></div></div></div></div></div></div><div style='display: none;'></div></div></div>";

final vidOnly =
    "<video playsinline webkit-playsinline src='blob:https://www.twitch.tv/8226fb92-a043-4b27-a0fc-e089805d7fcc'></video>";
